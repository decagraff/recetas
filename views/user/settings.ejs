<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | <%= appConfig.name %></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="/css/components.css">
</head>
<body class="page-<%= page %>">
    <%- include('../partials/navbar') %>
    <main class="main-content">
        <div class="settings-page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-cog"></i> Configuración</h1>
                </div>
                
                <% if (success) { %>
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        <span><%= success %></span>
                    </div>
                <% } %>
                
                <% if (errors.length > 0) { %>
                    <div class="alert alert-error">
                        <i class="fas fa-exclamation-circle"></i>
                        <ul>
                            <% errors.forEach(function(err) { %>
                                <li><%= err.msg %></li>
                            <% }); %>
                        </ul>
                    </div>
                <% } %>
                
                <div class="settings-container">
                    <div class="settings-tabs">
                        <button class="tab-btn <%= activeTab === 'account' ? 'active' : '' %>" data-tab="account">
                            <i class="fas fa-user"></i> Cuenta
                        </button>
                        <button class="tab-btn <%= activeTab === 'security' ? 'active' : '' %>" data-tab="security">
                            <i class="fas fa-lock"></i> Seguridad
                        </button>
                        <button class="tab-btn <%= activeTab === 'privacy' ? 'active' : '' %>" data-tab="privacy">
                            <i class="fas fa-shield-alt"></i> Privacidad
                        </button>
                        <button class="tab-btn <%= activeTab === 'danger' ? 'active' : '' %>" data-tab="danger">
                            <i class="fas fa-exclamation-triangle"></i> Zona Peligrosa
                        </button>
                    </div>
                    
                    <div class="settings-content">
                        <div class="tab-panel <%= activeTab === 'account' ? 'active' : '' %>" data-tab="account">
                            <h2>Información de Cuenta</h2>
                            
                            <div class="setting-section">
                                <h3><i class="fas fa-envelope"></i> Cambiar Email</h3>
                                <p class="text-muted">Email actual: <strong><%= user.email %></strong></p>
                                
                                <form action="/settings/email" method="POST" class="setting-form">
                                    <div class="form-group">
                                        <label for="newEmail">Nuevo Email</label>
                                        <input type="email" id="newEmail" name="newEmail" required placeholder="nuevo@email.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="emailPassword">Contraseña Actual</label>
                                        <input type="password" id="emailPassword" name="password" required placeholder="Confirma tu contraseña">
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Cambiar Email
                                    </button>
                                </form>
                            </div>
                            
                            <div class="setting-section">
                                <h3><i class="fas fa-user"></i> Información</h3>
                                <p><strong>Usuario:</strong> @<%= user.username %></p>
                                <p><strong>Nombre:</strong> <%= user.firstName && user.lastName ? user.firstName + ' ' + user.lastName : 'No especificado' %></p>
                                <p><strong>Miembro desde:</strong> <%= new Date(user.createdAt).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
                                <a href="/user/edit" class="btn btn-outline">
                                    <i class="fas fa-edit"></i> Editar Perfil
                                </a>
                            </div>
                        </div>
                        
                        <div class="tab-panel <%= activeTab === 'security' ? 'active' : '' %>" data-tab="security">
                            <h2>Seguridad</h2>
                            
                            <div class="setting-section">
                                <h3><i class="fas fa-key"></i> Cambiar Contraseña</h3>
                                <p class="text-muted">Te recomendamos usar una contraseña fuerte y única</p>
                                
                                <form action="/settings/password" method="POST" class="setting-form">
                                    <div class="form-group">
                                        <label for="currentPassword">Contraseña Actual</label>
                                        <input type="password" id="currentPassword" name="currentPassword" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="newPassword">Nueva Contraseña</label>
                                        <input type="password" id="newPassword" name="newPassword" required minlength="6">
                                        <small class="form-hint">Mínimo 6 caracteres</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmNewPassword">Confirmar Nueva Contraseña</label>
                                        <input type="password" id="confirmNewPassword" name="confirmNewPassword" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Cambiar Contraseña
                                    </button>
                                </form>
                            </div>
                            
                            <div class="setting-section">
                                <h3><i class="fas fa-clock"></i> Última Actividad</h3>
                                <p><strong>Último acceso:</strong> <%= user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleString('es-ES') : 'No disponible' %></p>
                            </div>
                        </div>
                        
                        <div class="tab-panel <%= activeTab === 'privacy' ? 'active' : '' %>" data-tab="privacy">
                            <h2>Privacidad</h2>
                            
                            <div class="setting-section">
                                <h3><i class="fas fa-eye"></i> Visibilidad del Perfil</h3>
                                <p class="text-muted">Controla quién puede ver tu perfil y contenido</p>
                                
                                <form action="/settings/privacy" method="POST" class="setting-form">
                                    <div class="form-check">
                                        <input type="checkbox" id="publicProfile" name="publicProfile" checked>
                                        <label for="publicProfile">Perfil público (cualquiera puede ver tus recetas)</label>
                                    </div>
                                    
                                    <div class="form-check">
                                        <input type="checkbox" id="showEmail" name="showEmail">
                                        <label for="showEmail">Mostrar email en perfil</label>
                                    </div>
                                    
                                    <div class="form-check">
                                        <input type="checkbox" id="allowMessages" name="allowMessages" checked>
                                        <label for="allowMessages">Permitir mensajes privados</label>
                                    </div>
                                    
                                    <div class="form-check">
                                        <input type="checkbox" id="showInRankings" name="showInRankings" checked>
                                        <label for="showInRankings">Aparecer en rankings públicos</label>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Guardar Privacidad
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <div class="tab-panel <%= activeTab === 'danger' ? 'active' : '' %>" data-tab="danger">
                            <h2>Zona Peligrosa</h2>
                            
                            <div class="setting-section danger-zone">
                                <h3><i class="fas fa-trash-alt"></i> Eliminar Cuenta</h3>
                                <p class="text-danger"><strong>¡ADVERTENCIA!</strong> Esta acción es irreversible.</p>
                                <p>Se eliminará permanentemente:</p>
                                <ul>
                                    <li>Tu perfil y toda tu información personal</li>
                                    <li>Todas tus recetas publicadas</li>
                                    <li>Tus comentarios y likes</li>
                                    <li>Tus seguidores y seguidos</li>
                                    <li>Todas tus colecciones</li>
                                </ul>
                                
                                <button type="button" class="btn btn-danger" onclick="showDeleteModal()">
                                    <i class="fas fa-exclamation-triangle"></i> Eliminar Mi Cuenta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> ¿Eliminar cuenta?</h2>
                    <button class="modal-close" onclick="hideDeleteModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="text-danger"><strong>Esta acción NO se puede deshacer</strong></p>
                    <p>Para confirmar, escribe <strong>ELIMINAR</strong> y tu contraseña:</p>
                    
                    <form action="/settings/delete" method="POST" id="deleteForm">
                        <div class="form-group">
                            <label for="confirmDelete">Escribe ELIMINAR</label>
                            <input type="text" id="confirmDelete" name="confirmDelete" required placeholder="ELIMINAR">
                        </div>
                        <div class="form-group">
                            <label for="deletePassword">Tu Contraseña</label>
                            <input type="password" id="deletePassword" name="password" required>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn-outline" onclick="hideDeleteModal()">Cancelar</button>
                            <button type="submit" class="btn btn-danger">Eliminar Definitivamente</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
    <%- include('../partials/footer') %>
    <script src="/js/main.js"></script>
    <script src="/js/theme-toggle.js"></script>
    
    <style>
    .settings-page { padding: 2rem 0; }
    .page-header { margin-bottom: 2rem; }
    .page-header h1 { margin: 0; color: var(--text-primary); }
    .alert { padding: 1rem; border-radius: 12px; margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem; }
    .alert-success { background: rgba(16, 185, 129, 0.1); border: 2px solid var(--success); color: var(--success); }
    .alert-error { background: rgba(239, 68, 68, 0.1); border: 2px solid var(--error); color: var(--error); }
    .alert ul { list-style: none; padding: 0; margin: 0; }
    .settings-container { display: grid; grid-template-columns: 250px 1fr; gap: 2rem; }
    .settings-tabs { display: flex; flex-direction: column; gap: 0.5rem; }
    .tab-btn { padding: 1rem; background: var(--bg-secondary); border: 2px solid transparent; border-radius: 12px; text-align: left; cursor: pointer; transition: all 0.3s ease; color: var(--text-primary); font-size: 1rem; display: flex; align-items: center; gap: 0.75rem; }
    .tab-btn:hover { background: var(--bg-tertiary); }
    .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
    .settings-content { background: var(--bg-secondary); padding: 2rem; border-radius: 16px; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .tab-panel h2 { margin: 0 0 2rem 0; color: var(--text-primary); }
    .setting-section { padding: 2rem 0; border-bottom: 1px solid var(--border-color); }
    .setting-section:last-child { border-bottom: none; }
    .setting-section h3 { margin: 0 0 1rem 0; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem; }
    .text-muted { color: var(--text-secondary); }
    .text-danger { color: var(--error); }
    .setting-form { display: flex; flex-direction: column; gap: 1rem; max-width: 500px; margin-top: 1rem; }
    .form-check { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; }
    .form-check input[type="checkbox"] { width: auto; cursor: pointer; }
    .form-check label { margin: 0; cursor: pointer; }
    .danger-zone { background: rgba(239, 68, 68, 0.05); padding: 2rem; border-radius: 12px; border: 2px solid var(--error); }
    .danger-zone ul { margin: 1rem 0; padding-left: 1.5rem; color: var(--text-secondary); }
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 9999; align-items: center; justify-content: center; }
    .modal.active { display: flex; }
    .modal-content { background: var(--bg-primary); border-radius: 16px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-bottom: 1px solid var(--border-color); }
    .modal-header h2 { margin: 0; color: var(--error); }
    .modal-close { background: none; border: none; font-size: 2rem; cursor: pointer; color: var(--text-primary); }
    .modal-body { padding: 1.5rem; }
    .modal-actions { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem; }
    @media (max-width: 768px) {
        .settings-container { grid-template-columns: 1fr; }
        .settings-tabs { flex-direction: row; overflow-x: auto; }
        .tab-btn { min-width: 150px; }
    }
    </style>
    
    <script>
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const tab = this.getAttribute('data-tab');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.querySelector('.tab-panel[data-tab="' + tab + '"]').classList.add('active');
        });
    });
    
    function showDeleteModal() {
        document.getElementById('deleteModal').classList.add('active');
    }
    
    function hideDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
        document.getElementById('deleteForm').reset();
    }
    
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            hideDeleteModal();
        }
    });
    </script>
</body>
</html>
